# TwitterClone — клонированный API Твиттера (FastAPI)

Учебный проект на FastAPI + SQLAlchemy (async) — минимальный API-клон Твиттера:
создание твитов, загрузка медиа, лайки, подписки, получение профиля и ленты.

> В проекте используются асинхронные SQLAlchemy-модели (create_async_engine, AsyncSession)
> и Pydantic-схемы для входных данных.

## Описание
Проект реализует следующие возможности:
- Создание твитов (текст + список id медиа)
- Загрузка и отдача бинарных медиа-файлов
- Удаление твитов (только владельцем)
- Поставить/удалить лайк
- Подписаться/отписаться от пользователя
- Получение списка твитов (агрегация вложений и лайков)
- Получение профиля текущего пользователя и профиля по id
- Отдача статических файлов и index.html в корне

---

## Установка и настройка

1. **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/vanopavlo/twitterclone
    ```

2. **Создайте файл `.env` со следующей структурой:**

    ```env
    ENGINE=postgresql+asyncpg://username:password@0.0.0.0/db_name
    ```

3. **Установите зависимости:**

    ```bash
    pip install -r requirements.txt
    ```

4. **Запустите приложение:**

    ```bash
    docker compose up
    ```

---


   По умолчанию приложение слушает `http://localhost:8080`. Главная страница — `/` (сервирует `templates/index.html`).

## Переменные окружения
Проект использует `.env` (через python-dotenv в моделях). Основная переменная:

- `ENGINE` — SQLAlchemy URL для подключения к БД.
  - Пример для SQLite-файла:
    sqlite+aiosqlite:///./data.db
  - Пример для PostgreSQL:
    postgresql+asyncpg://user:pass@localhost:5432/dbname

При тестах мы используем temporary SQLite-файл (см. tests/conftest.py).

## База данных
Модели находятся в `database/models.py`. Перед запуском приложение при старте выполнит:
`Base.metadata.create_all` (через lifespan) — создаст таблицы, если их нет.

Примечание: модели используют `ARRAY(Integer)` для `tweet_media_ids` (Postgres). Для локального тестирования в SQLite проект в тестах подменяет этот тип на JSON. В продакшн рекомендуется использовать PostgreSQL.


## Эндпоинты и примеры использования

Все запросы, требующие аутентификации, используют заголовок `api_key` в сигнатуре функции, поэтому в HTTP надо передавать заголовок с дефисом: `api-key: <value>`. 

Подробное описание всех эндпоинтов, схем запросов и ответов доступно в интерактивной документации по адресу `http://localhost:8080/docs`

Статические файлы:
- `/static`, `/css`, `/js` — монтируются через StaticFiles и отдают содержимое папки `static/`.

## Особенности и ограничения
- Модели используют Postgres-специфичные типы/функции (ARRAY, array_agg, .any). Для корректной работы всех агрегатов и запросов рекомендуется использовать PostgreSQL.
- Текущая тестовая конфигурация подменяет некоторые вещи для работы на SQLite (в тестах происходит замена типа `ARRAY` на JSON и т.д.).
- Аутентификация реализована очень просто (api_key в заголовке)



## Лицензия

N/A

---

## Контактные данные

**Автор:** Иван 
**Telegram:** @illidar


---
